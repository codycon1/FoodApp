// jQuery selectAutocomplete plugin
// https://github.com/art-mironoff/jQuery-selectAutocomplete
"function"!=typeof Object.create&&(Object.create=function(t){function i(){}return i.prototype=t,new i}),function(t){"use strict";var i={$input:null,$wrap:null,$dropdown:null,$ul:null,$button:null,KEYS:{LEFT:37,UP:38,RIGHT:39,DOWN:40,ESC:27,ENTER:13,TAB:9},init:function(i,e){this.config=t.extend({},t.fn.selectAutocomplete.defaults,i),this.$input=t(e);var n=t("<div/>",{attr:this.config.wrapperAttrs});this.$wrap=this.$input.wrap(n).parent();var s=t("<div/>",{attr:this.config.dropdownAttrs});if(this.$dropdown=this.$wrap.append(s).children("div"),this.$ul=this.$dropdown.append("<ul/>").children("ul"),this.config.showCancelButton){var o=t("<button/>",{text:this.config.cancelButtonText});this.$button=this.$dropdown.append(o).children("button")}this.updateDropdown(""),this.$input.on({"keydown.selectAutocomplete":this.onKeydown.bind(this),"keyup.selectAutocomplete":this.onKeyup.bind(this)}),this.$ul.on("click","li",this.onListClick.bind(this)),this.$button.on("click",this.onCancelClick.bind(this))},updateDropdown:function(t){for(var i=this.config.data,e="",n=0,s=i.length;s>n;n++)new RegExp(t.toLowerCase()).test(i[n].name.toLowerCase())&&(e+="<li data-id='"+i[n].id+"'>"+i[n].name+"</li>");this.$ul.html(e)},onKeydown:function(i){var e,n;i.which!=this.KEYS.DOWN&&i.which!=this.KEYS.UP||!this.$ul.html()?i.which==this.KEYS.ESC?this.$input.val(""):i.which!=this.KEYS.ENTER&&i.which!=this.KEYS.TAB||(n=t("li.selected",this.$ul),n.length&&(this.updateDropdown(n.text()),this.config.onSelect(i,n.data("id"),n.text()))):(n=t("li.selected",this.$ul),n.length?(e=i.which==this.KEYS.DOWN?n.next("li"):n.prev("li"),e.length?this.$input.val(e.addClass("selected").text()):this.$input.val(""),n.removeClass("selected")):(e=i.which==this.KEYS.DOWN?t("li",this.$ul).first():t("li",this.$ul).last(),this.$input.val(e.addClass("selected").text())))},onKeyup:function(i){if(!~t.inArray(i.which,[this.KEYS.LEFT,this.KEYS.UP,this.KEYS.RIGHT,this.KEYS.DOWN,this.KEYS.ENTER,this.KEYS.ESC,this.KEYS.TAB])){var e=this.$input.val();e.length<this.config.minLength?this.updateDropdown(""):this.updateDropdown(e)}},onListClick:function(i){t("li.selected",this.$ul).removeClass("selected");var e=t(i.target).addClass("selected"),n=e.data("id"),s=e.text();this.$input.val(s),this.config.onSelect(i,n,s)},onCancelClick:function(t){this.$input.val(""),this.updateDropdown(""),this.config.onCancel(t)}};t.fn.selectAutocomplete=function(e){return this.each(function(){if("destroy"===e)return t("div",t(this).parent()).remove(),void t(this).unwrap().off("keydown.selectAutocomplete keyup.selectAutocomplete");var n=Object.create(i);n.init(e,this)})},t.fn.selectAutocomplete.defaults={cancelButtonText:"Remove",data:[],dropdownAttrs:{"class":"dropdown"},minLength:3,onSelect:function(){},onCancel:function(){},showCancelButton:!1,wrapperAttrs:{"class":"select-autocomplete"}}}(jQuery);